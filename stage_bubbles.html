<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trading Wheels — Stage (Bubbles)</title>
<style>
  :root {
    --bg:#76787a;
    --panel:rgba(28,32,38,0.15); /* more transparent! */
    --chip:rgba(35,39,51,0.85);
    --chip-border:#2f333d;
    --text:#cfd4e0;
    --muted:#9ba0ad;
    --accent:#47e8c0;
  }
  html, body {
    height: 100%;
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  }

  body {
    background-image: url("Fantasy_Background.png");
    background-repeat: no-repeat;
    background-position: center center;
    background-size: cover;
    background-attachment: fixed;
    background-blend-mode: normal;
  }

  header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 20px;
  }
  header img {
    height: 40px;
  }
  header h1 {
    font-size: 32px;
    margin: 0;
    font-weight: 800;
  }

  .wrap {
    min-height: 100%;
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 12px;
  }

  .panel {
    background: var(--panel);
    border-radius: 14px;
    padding: 20px 18px;
    max-width: 1800px;
    margin: 0 auto;
    box-shadow: 0 8px 24px rgba(0,0,0,.2);
    backdrop-filter: blur(6px); /* nice subtle blur effect */
  }

  .title {
    color: var(--accent);
    font-weight: 900;
    font-size: 54px;
    margin: 0 0 20px 0;
    text-align: center;
    letter-spacing: 0.5px;
    text-shadow:
      0 0 8px rgba(80, 227, 194, 0.8),
      0 0 20px rgba(80, 227, 194, 0.5),
      0 2px 4px rgba(0, 0, 0, 0.6);
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(var(--cols, 4), 1fr);
    grid-template-rows: repeat(var(--rows, 2), 1fr);
    gap: var(--gap, 60px);
    justify-items: center;
    align-items: center;
    min-height: 70vh;
    padding: 20px;
  }

  .chip {
    background: var(--chip);
    border: 1px solid var(--chip-border);
    border-radius: 999px;
    padding: 40px 60px;
    min-width: 240px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: var(--text);
    box-shadow: 0 6px 18px rgba(0,0,0,.25);
    user-select: none;
  }

  .sym {
    font-weight: 900;
    letter-spacing: 1px;
    line-height: 1;
  }

  .size-xl { font-size: 72px; }
  .size-l { font-size: 56px; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <!-- Two logos side by side -->
      <img src="Trading Wheels.png" alt="Trading Wheels Logo" />
      <img src="stock_logo.png" alt="Stock X Logo" />
      <h1>Trading Wheels Fantasy Stock Ball — Live Draft Board</h1>
    </header>

    <div class="panel">
      <h2 id="title" class="title"></h2>
      <div id="grid" class="grid"></div>
    </div>
  </div>

<script>
(async function(){
  const qs = new URLSearchParams(location.search);
  const csvURL = qs.get("csv");
  const rows = parseInt(qs.get("rows") || "2", 10);
  const cols = parseInt(qs.get("cols") || "4", 10);
  const size = (qs.get("size") || "xl").toLowerCase();
  const gap = qs.get("gap") || "60";
  const title = qs.get("title") || "QB (MAG7 + NFLX)";

  document.getElementById("title").textContent = title;
  const grid = document.getElementById("grid");
  grid.style.setProperty("--rows", rows);
  grid.style.setProperty("--cols", cols);
  grid.style.setProperty("--gap", `${parseInt(gap, 10)}px`);

  if (!csvURL) {
    grid.innerHTML = "<div style='color:#ffdddd'>Missing ?csv=…</div>";
    return;
  }

  try {
    const res = await fetch(csvURL + (csvURL.includes("?") ? "&" : "?") + "cache=" + Date.now());
    const text = await res.text();
    const lines = text.replace(/\r\n/g, "\n").split("\n").filter(Boolean);

    let start = 0, header = lines[0].split(",");
    if (/^"?title"?$/i.test(header[0]?.trim())) {
      start = 2;
      header = lines[1].split(",");
    }
    const h = header.map(x => x.trim().toLowerCase());

    let symIdx = h.findIndex(x => ["symbol","ticker","stock","c"].includes(x));
    if (symIdx < 0) symIdx = 2;

    const items = [];
    for (let i = start + 1; i < lines.length; i++) {
      const row = splitCSV(lines[i]);
      if (!row.length) continue;
      const sym = (row[symIdx] || "").trim();
      if (!sym) continue;
      items.push(sym);
    }

    const sizeClass = size === "l" ? "size-l" : "size-xl";
    grid.innerHTML = "";
    items.slice(0, rows * cols).forEach(sym => {
      const div = document.createElement("div");
      div.className = "chip";
      div.innerHTML = `<div class="sym ${sizeClass}">${escapeHTML(sym)}</div>`;
      grid.appendChild(div);
    });

  } catch (e) {
    console.error(e);
    grid.innerHTML = "<div style='color:#ffdddd'>Failed to load CSV.</div>";
  }

  function splitCSV(line){
    const out = []; let cur = "", q = false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch === '"'){
        if(q && line[i+1] === '"'){ cur+='"'; i++; }
        else q=!q;
      } else if(ch === ',' && !q){
        out.push(cur); cur="";
      } else cur+=ch;
    }
    out.push(cur);
    return out;
  }

  function escapeHTML(s){
    return s.replace(/[&<>"]/g,c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[c]));
  }
})();
</script>
</body>
</html>
